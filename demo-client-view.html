<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reivilo B2B Portal - Live Product Catalog Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; 
            background: #f8fafc; 
            color: #1e293b;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { 
            background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%); 
            color: white; 
            padding: 30px; 
            border-radius: 12px; 
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(30, 58, 138, 0.15);
        }
        .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; opacity: 0.9; }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 4px solid #1E3A8A;
        }
        .stat-value { font-size: 2rem; font-weight: 700; color: #1E3A8A; }
        .stat-label { font-size: 0.875rem; color: #64748b; margin-top: 5px; }
        .controls { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .search-box { 
            width: 100%; 
            padding: 12px 16px; 
            border: 2px solid #e2e8f0; 
            border-radius: 8px; 
            font-size: 1rem;
            margin-bottom: 15px;
        }
        .search-box:focus { border-color: #1E3A8A; outline: none; }
        .filters { display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .filter-select { 
            padding: 10px 15px; 
            border: 2px solid #e2e8f0; 
            border-radius: 6px; 
            background: white;
            font-size: 0.875rem;
        }
        .product-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
            gap: 20px; 
        }
        .product-card { 
            background: white; 
            border-radius: 12px; 
            padding: 20px; 
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            border: 1px solid #f1f5f9;
        }
        .product-card:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 8px 30px rgba(0,0,0,0.12); 
        }
        .product-image { 
            width: 80px; 
            height: 80px; 
            background: linear-gradient(135deg, #1E3A8A15 0%, #3B82F630 100%); 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 600; 
            color: #1E3A8A; 
            margin-bottom: 15px;
            border: 2px solid #e2e8f0;
        }
        .product-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; color: #1e293b; }
        .product-sku { font-size: 0.875rem; color: #64748b; margin-bottom: 10px; }
        .product-category { 
            display: inline-block; 
            background: #f1f5f9; 
            color: #475569; 
            padding: 4px 10px; 
            border-radius: 15px; 
            font-size: 0.75rem; 
            margin-bottom: 12px;
        }
        .stock-info { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .stock-status { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .stock-indicator { 
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
        }
        .in-stock { background: #10b981; }
        .low-stock { background: #f59e0b; }
        .out-stock { background: #ef4444; }
        .warehouse-grid { 
            display: grid; 
            grid-template-columns: repeat(3, 1fr); 
            gap: 8px; 
            margin-bottom: 15px; 
        }
        .warehouse-item { 
            text-align: center; 
            padding: 8px; 
            background: #f8fafc; 
            border-radius: 6px; 
            border: 1px solid #e2e8f0;
        }
        .warehouse-name { font-size: 0.75rem; color: #64748b; margin-bottom: 4px; }
        .warehouse-stock { font-size: 0.875rem; font-weight: 600; color: #1e293b; }
        .add-to-cart { 
            width: 100%; 
            background: #1E3A8A; 
            color: white; 
            border: none; 
            padding: 12px; 
            border-radius: 8px; 
            font-weight: 600; 
            cursor: pointer;
            transition: background 0.2s;
        }
        .add-to-cart:hover { background: #1e40af; }
        .add-to-cart:disabled { background: #9ca3af; cursor: not-allowed; }
        .quantity-controls { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 12px; 
        }
        .quantity-input { 
            flex: 1; 
            padding: 8px; 
            border: 1px solid #e2e8f0; 
            border-radius: 6px; 
            text-align: center;
        }
        .warehouse-select { 
            flex: 2; 
            padding: 8px; 
            border: 1px solid #e2e8f0; 
            border-radius: 6px; 
            background: white;
        }
        .loading { 
            text-align: center; 
            padding: 60px; 
            color: #64748b; 
            font-size: 1.1rem; 
        }
        .error { 
            background: #fef2f2; 
            color: #dc2626; 
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 20px;
            border-left: 4px solid #dc2626;
        }
        .pagination { 
            display: flex; 
            justify-content: center; 
            gap: 10px; 
            margin-top: 30px; 
        }
        .page-btn { 
            padding: 10px 15px; 
            border: 1px solid #e2e8f0; 
            background: white; 
            border-radius: 6px; 
            cursor: pointer;
            transition: all 0.2s;
        }
        .page-btn:hover, .page-btn.active { 
            background: #1E3A8A; 
            color: white; 
            border-color: #1E3A8A; 
        }
        .currency { color: #059669; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Reivilo B2B Portal</h1>
            <p>Family Business Values - Live Product Catalog</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalProducts">0</div>
                <div class="stat-label">Total Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="inStockProducts">0</div>
                <div class="stat-label">In Stock Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalWarehouses">3</div>
                <div class="stat-label">Warehouse Locations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="cartItems">0</div>
                <div class="stat-label">Cart Items</div>
            </div>
        </div>

        <div class="controls">
            <input type="text" class="search-box" placeholder="üîç Search products by name, SKU, or category..." id="searchInput">
            <div class="filters">
                <select class="filter-select" id="categoryFilter">
                    <option value="">All Categories</option>
                </select>
                <select class="filter-select" id="warehouseFilter">
                    <option value="">All Warehouses</option>
                    <option value="JHB">Johannesburg</option>
                    <option value="CPT">Cape Town</option>
                    <option value="BFN">Bloemfontein</option>
                </select>
                <select class="filter-select" id="stockFilter">
                    <option value="">All Stock Levels</option>
                    <option value="in-stock">In Stock</option>
                    <option value="low-stock">Low Stock</option>
                    <option value="out-stock">Out of Stock</option>
                </select>
            </div>
        </div>

        <div id="loadingMessage" class="loading">
            Loading live product data from Cin7...
        </div>

        <div id="errorMessage" class="error" style="display: none;">
            Unable to load product data. Please try again.
        </div>

        <div id="productGrid" class="product-grid" style="display: none;">
            <!-- Products will be loaded here -->
        </div>

        <div class="pagination" id="pagination" style="display: none;">
            <!-- Pagination will be loaded here -->
        </div>
    </div>

    <script>
        let allProducts = [];
        let allWarehouses = [];
        let filteredProducts = [];
        let cartItems = JSON.parse(localStorage.getItem('reivilo-cart') || '[]');

        // Update cart counter
        function updateCartCounter() {
            document.getElementById('cartItems').textContent = cartItems.length;
        }

        // Load product data
        async function loadProducts() {
            try {
                const [productsResponse, warehousesResponse] = await Promise.all([
                    fetch('/api/products'),
                    fetch('/api/warehouses')
                ]);

                if (!productsResponse.ok || !warehousesResponse.ok) {
                    throw new Error('Failed to fetch data');
                }

                const productsData = await productsResponse.json();
                const warehousesData = await warehousesResponse.json();

                allProducts = productsData.products || [];
                allWarehouses = warehousesData || [];
                filteredProducts = [...allProducts];

                // Update stats
                document.getElementById('totalProducts').textContent = allProducts.length;
                document.getElementById('inStockProducts').textContent = 
                    allProducts.filter(p => p.available > 0).length;

                // Populate category filter
                const categories = [...new Set(allProducts.map(p => p.category || 'Uncategorized'))];
                const categoryFilter = document.getElementById('categoryFilter');
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    categoryFilter.appendChild(option);
                });

                displayProducts();
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('productGrid').style.display = 'grid';

            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('loadingMessage').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        // Display products
        function displayProducts() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';

            filteredProducts.forEach(product => {
                const card = createProductCard(product);
                grid.appendChild(card);
            });
        }

        // Create product card
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';

            const stockStatus = product.available > 50 ? 'in-stock' : 
                               product.available > 0 ? 'low-stock' : 'out-stock';
            
            const stockText = product.available > 0 ? 
                            `In Stock (${product.available})` : 'Out of Stock';

            card.innerHTML = `
                <div class="product-image">
                    ${product.sku.substring(0, 3)}
                </div>
                <div class="product-name">${product.name}</div>
                <div class="product-sku">SKU: ${product.sku}</div>
                <div class="product-category">${product.category || 'Agriculture Tire'}</div>
                
                <div class="stock-info">
                    <div class="stock-status">
                        <div class="stock-indicator ${stockStatus}"></div>
                        <span>${stockText}</span>
                    </div>
                    <div class="currency">R ${product.price.toFixed(2)}</div>
                </div>

                <div class="warehouse-grid">
                    <div class="warehouse-item">
                        <div class="warehouse-name">JHB</div>
                        <div class="warehouse-stock">${product.warehouseBreakdown.jhb.available}</div>
                    </div>
                    <div class="warehouse-item">
                        <div class="warehouse-name">CPT</div>
                        <div class="warehouse-stock">${product.warehouseBreakdown.cpt.available}</div>
                    </div>
                    <div class="warehouse-item">
                        <div class="warehouse-name">BFN</div>
                        <div class="warehouse-stock">${product.warehouseBreakdown.bfn.available}</div>
                    </div>
                </div>

                <div class="quantity-controls">
                    <input type="number" class="quantity-input" value="1" min="1" max="${product.available}">
                    <select class="warehouse-select">
                        <option value="CPT">Cape Town Main</option>
                        <option value="JHB">Johannesburg</option>
                        <option value="BFN">Bloemfontein</option>
                    </select>
                </div>

                <button class="add-to-cart" ${product.available === 0 ? 'disabled' : ''} 
                        onclick="addToCart('${product.sku}', this)">
                    ${product.available === 0 ? 'Out of Stock' : 'Add to Cart'}
                </button>
            `;

            return card;
        }

        // Add to cart function
        function addToCart(sku, button) {
            const product = allProducts.find(p => p.sku === sku);
            if (!product || product.available === 0) return;

            const card = button.closest('.product-card');
            const quantity = parseInt(card.querySelector('.quantity-input').value) || 1;
            const warehouse = card.querySelector('.warehouse-select').value;

            const cartItem = {
                sku: product.sku,
                name: product.name,
                quantity: quantity,
                warehouse: warehouse,
                price: product.price,
                timestamp: Date.now()
            };

            cartItems.push(cartItem);
            localStorage.setItem('reivilo-cart', JSON.stringify(cartItems));
            updateCartCounter();

            // Visual feedback
            button.textContent = 'Added!';
            button.style.background = '#10b981';
            setTimeout(() => {
                button.textContent = 'Add to Cart';
                button.style.background = '#1E3A8A';
            }, 1500);
        }

        // Filter products
        function filterProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const categoryFilter = document.getElementById('categoryFilter').value;
            const warehouseFilter = document.getElementById('warehouseFilter').value;
            const stockFilter = document.getElementById('stockFilter').value;

            filteredProducts = allProducts.filter(product => {
                const matchesSearch = !searchTerm || 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.sku.toLowerCase().includes(searchTerm) ||
                    (product.category && product.category.toLowerCase().includes(searchTerm));

                const matchesCategory = !categoryFilter || product.category === categoryFilter;

                const matchesWarehouse = !warehouseFilter || 
                    product.warehouseBreakdown[warehouseFilter.toLowerCase()].available > 0;

                const matchesStock = !stockFilter ||
                    (stockFilter === 'in-stock' && product.available > 50) ||
                    (stockFilter === 'low-stock' && product.available > 0 && product.available <= 50) ||
                    (stockFilter === 'out-stock' && product.available === 0);

                return matchesSearch && matchesCategory && matchesWarehouse && matchesStock;
            });

            displayProducts();
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', filterProducts);
        document.getElementById('categoryFilter').addEventListener('change', filterProducts);
        document.getElementById('warehouseFilter').addEventListener('change', filterProducts);
        document.getElementById('stockFilter').addEventListener('change', filterProducts);

        // Initialize
        updateCartCounter();
        loadProducts();
    </script>
</body>
</html>